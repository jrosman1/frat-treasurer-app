{% extends "portal/base.html" %}

{% block content %}
  <h1>Admin</h1>

  <section>
    <h3>Role Management</h3>
    {% if users %}
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Roles</th>
            <th>Grant Role</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <tr>
              <td>{{ user.full_name }}</td>
              <td>{{ user.email or "" }}</td>
              <td>
                {% for role in user.get_active_roles() %}
                  <form method="post" action="{{ url_for('portal.remove_role', user_id=user.id, role_name=role.name) }}">
                    <span>{{ role.name }}</span>
                    <button type="submit">Revoke</button>
                  </form>
                {% endfor %}
              </td>
              <td>
                <form method="post" action="{{ url_for('portal.add_role', user_id=user.id) }}">
                  <input name="role_name" placeholder="role name" required>
                  <button type="submit">Grant</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No users found.</p>
    {% endif %}
  </section>

  <section>
    <h3>Semester Rollover</h3>
    <form method="post" action="{{ url_for('portal.semester_rollover') }}">
      <label>Name <input name="name" required></label>
      <label>Season <input name="season" required></label>
      <label>Year <input name="year" required></label>
      <label>Confirm (type ROLL_OVER) <input name="confirm" required></label>
      <button type="submit">Rollover</button>
    </form>
  </section>

  <section>
    <h3>Recent Audit Log</h3>
    {% if audit_entries %}
      <ul>
        {% for entry in audit_entries %}
          <li>{{ entry.created_at }} - {{ entry.action }} ({{ entry.target_type }})</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No audit entries yet.</p>
    {% endif %}
  </section>
{% endblock %}
